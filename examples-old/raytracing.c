#include <math.h>
#include <stdio.h>

#include <mat.h>
#include <mesh2.h>
#include <rtree.h>

void get_view_direction(dbl const left[3], dbl const front[3], dbl const up[3],
                        dbl phi, dbl theta, dbl ray[3]) {
  dbl zrot[3][3] = {
    { cos(phi), sin(phi), 0},
    {-sin(phi), cos(phi), 0},
    {        0,        0, 1}
  };
  dbl xrot[3][3] = {
    {1,           0,          0},
    {0,  cos(theta), sin(theta)},
    {0, -sin(theta), cos(theta)}
  };
  ray[0] = 0;
  ray[1] = 1;
  ray[2] = 0;
  dbl33_dbl3_mul_inplace(zrot, ray);
  dbl33_dbl3_mul_inplace(xrot, ray);
  dbl tmp[3] = {ray[0], ray[1], ray[2]};
  for (int i = 0; i < 3; ++i)
    ray[i] = left[i]*tmp[0] + front[i]*tmp[1] + up[i]*tmp[2];
}

int main() {
  dbl verts[][3] = {
    {-0.526, 0.851, 0.000},
    {0.526, 0.851, 0.000},
    {-0.526, -0.851, 0.000},
    {0.526, -0.851, 0.000},
    {0.000, -0.526, 0.851},
    {0.000, 0.526, 0.851},
    {0.000, -0.526, -0.851},
    {0.000, 0.526, -0.851},
    {0.851, 0.000, -0.526},
    {0.851, 0.000, 0.526},
    {-0.851, 0.000, -0.526},
    {-0.851, 0.000, 0.526},
    {0.113, 0.491, 0.864},
    {0.239, 0.443, 0.864},
    {0.371, 0.382, 0.847},
    {0.500, 0.309, 0.809},
    {0.618, 0.229, 0.752},
    {0.717, 0.148, 0.682},
    {0.794, 0.070, 0.604},
    {-0.907, 0.000, -0.421},
    {-0.955, 0.000, -0.295},
    {-0.988, 0.000, -0.153},
    {-1.000, 0.000, 0.000},
    {-0.988, 0.000, 0.153},
    {-0.955, 0.000, 0.295},
    {-0.907, 0.000, 0.421},
    {-0.491, 0.864, -0.113},
    {-0.443, 0.864, -0.239},
    {-0.382, 0.847, -0.371},
    {-0.309, 0.809, -0.500},
    {-0.229, 0.752, -0.618},
    {-0.148, 0.682, -0.717},
    {-0.070, 0.604, -0.794},
    {0.907, 0.000, -0.421},
    {0.955, 0.000, -0.295},
    {0.988, 0.000, -0.153},
    {1.000, 0.000, 0.000},
    {0.988, 0.000, 0.153},
    {0.955, 0.000, 0.295},
    {0.907, 0.000, 0.421},
    {-0.604, 0.794, -0.070},
    {-0.682, 0.717, -0.148},
    {-0.752, 0.618, -0.229},
    {-0.809, 0.500, -0.309},
    {-0.847, 0.371, -0.382},
    {-0.864, 0.239, -0.443},
    {-0.864, 0.113, -0.491},
    {0.000, -0.421, -0.907},
    {0.000, -0.295, -0.955},
    {0.000, -0.153, -0.988},
    {0.000, 0.000, -1.000},
    {0.000, 0.153, -0.988},
    {0.000, 0.295, -0.955},
    {0.000, 0.421, -0.907},
    {0.113, -0.491, 0.864},
    {0.239, -0.443, 0.864},
    {0.371, -0.382, 0.847},
    {0.500, -0.309, 0.809},
    {0.618, -0.229, 0.752},
    {0.717, -0.148, 0.682},
    {0.794, -0.070, 0.604},
    {-0.113, -0.491, -0.864},
    {-0.239, -0.443, -0.864},
    {-0.371, -0.382, -0.847},
    {-0.500, -0.309, -0.809},
    {-0.618, -0.229, -0.752},
    {-0.717, -0.148, -0.682},
    {-0.794, -0.070, -0.604},
    {0.491, 0.864, 0.113},
    {0.443, 0.864, 0.239},
    {0.382, 0.847, 0.371},
    {0.309, 0.809, 0.500},
    {0.229, 0.752, 0.618},
    {0.148, 0.682, 0.717},
    {0.070, 0.604, 0.794},
    {-0.604, 0.794, 0.070},
    {-0.682, 0.717, 0.148},
    {-0.752, 0.618, 0.229},
    {-0.809, 0.500, 0.309},
    {-0.847, 0.371, 0.382},
    {-0.864, 0.239, 0.443},
    {-0.864, 0.113, 0.491},
    {-0.113, 0.491, -0.864},
    {-0.239, 0.443, -0.864},
    {-0.371, 0.382, -0.847},
    {-0.500, 0.309, -0.809},
    {-0.618, 0.229, -0.752},
    {-0.717, 0.148, -0.682},
    {-0.794, 0.070, -0.604},
    {0.491, -0.864, -0.113},
    {0.443, -0.864, -0.239},
    {0.382, -0.847, -0.371},
    {0.309, -0.809, -0.500},
    {0.229, -0.752, -0.618},
    {0.148, -0.682, -0.717},
    {0.070, -0.604, -0.794},
    {0.491, -0.864, 0.113},
    {0.443, -0.864, 0.239},
    {0.382, -0.847, 0.371},
    {0.309, -0.809, 0.500},
    {0.229, -0.752, 0.618},
    {0.148, -0.682, 0.717},
    {0.070, -0.604, 0.794},
    {-0.491, -0.864, -0.113},
    {-0.443, -0.864, -0.239},
    {-0.382, -0.847, -0.371},
    {-0.309, -0.809, -0.500},
    {-0.229, -0.752, -0.618},
    {-0.148, -0.682, -0.717},
    {-0.070, -0.604, -0.794},
    {-0.113, 0.491, 0.864},
    {-0.239, 0.443, 0.864},
    {-0.371, 0.382, 0.847},
    {-0.500, 0.309, 0.809},
    {-0.618, 0.229, 0.752},
    {-0.717, 0.148, 0.682},
    {-0.794, 0.070, 0.604},
    {0.000, -0.421, 0.907},
    {0.000, -0.295, 0.955},
    {0.000, -0.153, 0.988},
    {0.000, 0.000, 1.000},
    {0.000, 0.153, 0.988},
    {0.000, 0.295, 0.955},
    {0.000, 0.421, 0.907},
    {-0.604, -0.794, -0.070},
    {-0.682, -0.717, -0.148},
    {-0.752, -0.618, -0.229},
    {-0.809, -0.500, -0.309},
    {-0.847, -0.371, -0.382},
    {-0.864, -0.239, -0.443},
    {-0.864, -0.113, -0.491},
    {0.604, -0.794, 0.070},
    {0.682, -0.717, 0.148},
    {0.752, -0.618, 0.229},
    {0.809, -0.500, 0.309},
    {0.847, -0.371, 0.382},
    {0.864, -0.239, 0.443},
    {0.864, -0.113, 0.491},
    {-0.491, 0.864, 0.113},
    {-0.443, 0.864, 0.239},
    {-0.382, 0.847, 0.371},
    {-0.309, 0.809, 0.500},
    {-0.229, 0.752, 0.618},
    {-0.148, 0.682, 0.717},
    {-0.070, 0.604, 0.794},
    {0.604, 0.794, 0.070},
    {0.682, 0.717, 0.148},
    {0.752, 0.618, 0.229},
    {0.809, 0.500, 0.309},
    {0.847, 0.371, 0.382},
    {0.864, 0.239, 0.443},
    {0.864, 0.113, 0.491},
    {-0.421, -0.907, 0.000},
    {-0.295, -0.955, 0.000},
    {-0.153, -0.988, 0.000},
    {0.000, -1.000, 0.000},
    {0.153, -0.988, 0.000},
    {0.295, -0.955, 0.000},
    {0.421, -0.907, 0.000},
    {-0.113, -0.491, 0.864},
    {-0.239, -0.443, 0.864},
    {-0.371, -0.382, 0.847},
    {-0.500, -0.309, 0.809},
    {-0.618, -0.229, 0.752},
    {-0.717, -0.148, 0.682},
    {-0.794, -0.070, 0.604},
    {-0.421, 0.907, 0.000},
    {-0.295, 0.955, 0.000},
    {-0.153, 0.988, 0.000},
    {0.000, 1.000, 0.000},
    {0.153, 0.988, 0.000},
    {0.295, 0.955, 0.000},
    {0.421, 0.907, 0.000},
    {0.113, -0.491, -0.864},
    {0.239, -0.443, -0.864},
    {0.371, -0.382, -0.847},
    {0.500, -0.309, -0.809},
    {0.618, -0.229, -0.752},
    {0.717, -0.148, -0.682},
    {0.794, -0.070, -0.604},
    {-0.604, -0.794, 0.070},
    {-0.682, -0.717, 0.148},
    {-0.752, -0.618, 0.229},
    {-0.809, -0.500, 0.309},
    {-0.847, -0.371, 0.382},
    {-0.864, -0.239, 0.443},
    {-0.864, -0.113, 0.491},
    {0.604, -0.794, -0.070},
    {0.682, -0.717, -0.148},
    {0.752, -0.618, -0.229},
    {0.809, -0.500, -0.309},
    {0.847, -0.371, -0.382},
    {0.864, -0.239, -0.443},
    {0.864, -0.113, -0.491},
    {0.604, 0.794, -0.070},
    {0.682, 0.717, -0.148},
    {0.752, 0.618, -0.229},
    {0.809, 0.500, -0.309},
    {0.847, 0.371, -0.382},
    {0.864, 0.239, -0.443},
    {0.864, 0.113, -0.491},
    {0.491, 0.864, -0.113},
    {0.443, 0.864, -0.239},
    {0.382, 0.847, -0.371},
    {0.309, 0.809, -0.500},
    {0.229, 0.752, -0.618},
    {0.148, 0.682, -0.717},
    {0.070, 0.604, -0.794},
    {0.113, 0.491, -0.864},
    {0.239, 0.443, -0.864},
    {0.371, 0.382, -0.847},
    {0.500, 0.309, -0.809},
    {0.618, 0.229, -0.752},
    {0.717, 0.148, -0.682},
    {0.794, 0.070, -0.604},
    {-0.491, -0.864, 0.113},
    {-0.443, -0.864, 0.239},
    {-0.382, -0.847, 0.371},
    {-0.309, -0.809, 0.500},
    {-0.229, -0.752, 0.618},
    {-0.148, -0.682, 0.717},
    {-0.070, -0.604, 0.794},
    {-0.569, 0.799, 0.195},
    {-0.644, 0.711, 0.283},
    {-0.710, 0.599, 0.370},
    {-0.759, 0.469, 0.450},
    {-0.789, 0.331, 0.517},
    {-0.799, 0.195, 0.569},
    {-0.517, 0.789, 0.331},
    {-0.588, 0.688, 0.425},
    {-0.647, 0.564, 0.513},
    {-0.688, 0.425, 0.588},
    {-0.711, 0.283, 0.644},
    {-0.450, 0.759, 0.469},
    {-0.513, 0.647, 0.564},
    {-0.564, 0.513, 0.647},
    {-0.599, 0.370, 0.710},
    {-0.370, 0.710, 0.599},
    {-0.425, 0.588, 0.688},
    {-0.469, 0.450, 0.759},
    {-0.283, 0.644, 0.711},
    {-0.331, 0.517, 0.789},
    {-0.195, 0.569, 0.799},
    {-0.373, 0.920, 0.121},
    {-0.313, 0.916, 0.253},
    {-0.241, 0.889, 0.389},
    {-0.160, 0.840, 0.519},
    {-0.078, 0.771, 0.633},
    {0.000, 0.689, 0.725},
    {-0.235, 0.964, 0.127},
    {-0.162, 0.951, 0.263},
    {-0.082, 0.913, 0.400},
    {0.000, 0.851, 0.526},
    {0.078, 0.771, 0.633},
    {-0.080, 0.988, 0.130},
    {0.000, 0.964, 0.266},
    {0.082, 0.913, 0.400},
    {0.160, 0.840, 0.519},
    {0.080, 0.988, 0.130},
    {0.162, 0.951, 0.263},
    {0.241, 0.889, 0.389},
    {0.235, 0.964, 0.127},
    {0.313, 0.916, 0.253},
    {0.373, 0.920, 0.121},
    {-0.373, 0.920, -0.121},
    {-0.235, 0.964, -0.127},
    {-0.080, 0.988, -0.130},
    {0.080, 0.988, -0.130},
    {0.235, 0.964, -0.127},
    {0.373, 0.920, -0.121},
    {-0.313, 0.916, -0.253},
    {-0.162, 0.951, -0.263},
    {0.000, 0.964, -0.266},
    {0.162, 0.951, -0.263},
    {0.313, 0.916, -0.253},
    {-0.241, 0.889, -0.389},
    {-0.082, 0.913, -0.400},
    {0.082, 0.913, -0.400},
    {0.241, 0.889, -0.389},
    {-0.160, 0.840, -0.519},
    {0.000, 0.851, -0.526},
    {0.160, 0.840, -0.519},
    {-0.078, 0.771, -0.633},
    {0.078, 0.771, -0.633},
    {0.000, 0.689, -0.725},
    {-0.569, 0.799, -0.195},
    {-0.517, 0.789, -0.331},
    {-0.450, 0.759, -0.469},
    {-0.370, 0.710, -0.599},
    {-0.283, 0.644, -0.711},
    {-0.195, 0.569, -0.799},
    {-0.644, 0.711, -0.283},
    {-0.588, 0.688, -0.425},
    {-0.513, 0.647, -0.564},
    {-0.425, 0.588, -0.688},
    {-0.331, 0.517, -0.789},
    {-0.710, 0.599, -0.370},
    {-0.647, 0.564, -0.513},
    {-0.564, 0.513, -0.647},
    {-0.469, 0.450, -0.759},
    {-0.759, 0.469, -0.450},
    {-0.688, 0.425, -0.588},
    {-0.599, 0.370, -0.710},
    {-0.789, 0.331, -0.517},
    {-0.711, 0.283, -0.644},
    {-0.799, 0.195, -0.569},
    {-0.689, 0.725, 0.000},
    {-0.771, 0.633, -0.078},
    {-0.840, 0.519, -0.160},
    {-0.889, 0.389, -0.241},
    {-0.916, 0.253, -0.313},
    {-0.920, 0.121, -0.373},
    {-0.771, 0.633, 0.078},
    {-0.851, 0.526, 0.000},
    {-0.913, 0.400, -0.082},
    {-0.951, 0.263, -0.162},
    {-0.964, 0.127, -0.235},
    {-0.840, 0.519, 0.160},
    {-0.913, 0.400, 0.082},
    {-0.964, 0.266, 0.000},
    {-0.988, 0.130, -0.080},
    {-0.889, 0.389, 0.241},
    {-0.951, 0.263, 0.162},
    {-0.988, 0.130, 0.080},
    {-0.916, 0.253, 0.313},
    {-0.964, 0.127, 0.235},
    {-0.920, 0.121, 0.373},
    {0.569, 0.799, 0.195},
    {0.517, 0.789, 0.331},
    {0.450, 0.759, 0.469},
    {0.370, 0.710, 0.599},
    {0.283, 0.644, 0.711},
    {0.195, 0.569, 0.799},
    {0.644, 0.711, 0.283},
    {0.588, 0.688, 0.425},
    {0.513, 0.647, 0.564},
    {0.425, 0.588, 0.688},
    {0.331, 0.517, 0.789},
    {0.710, 0.599, 0.370},
    {0.647, 0.564, 0.513},
    {0.564, 0.513, 0.647},
    {0.469, 0.450, 0.759},
    {0.759, 0.469, 0.450},
    {0.688, 0.425, 0.588},
    {0.599, 0.370, 0.710},
    {0.789, 0.331, 0.517},
    {0.711, 0.283, 0.644},
    {0.799, 0.195, 0.569},
    {-0.121, 0.373, 0.920},
    {-0.253, 0.313, 0.916},
    {-0.389, 0.241, 0.889},
    {-0.519, 0.160, 0.840},
    {-0.633, 0.078, 0.771},
    {-0.725, 0.000, 0.689},
    {-0.127, 0.235, 0.964},
    {-0.263, 0.162, 0.951},
    {-0.400, 0.082, 0.913},
    {-0.526, 0.000, 0.851},
    {-0.633, -0.078, 0.771},
    {-0.130, 0.080, 0.988},
    {-0.266, 0.000, 0.964},
    {-0.400, -0.082, 0.913},
    {-0.519, -0.160, 0.840},
    {-0.130, -0.080, 0.988},
    {-0.263, -0.162, 0.951},
    {-0.389, -0.241, 0.889},
    {-0.127, -0.235, 0.964},
    {-0.253, -0.313, 0.916},
    {-0.121, -0.373, 0.920},
    {-0.920, -0.121, 0.373},
    {-0.964, -0.127, 0.235},
    {-0.988, -0.130, 0.080},
    {-0.988, -0.130, -0.080},
    {-0.964, -0.127, -0.235},
    {-0.920, -0.121, -0.373},
    {-0.916, -0.253, 0.313},
    {-0.951, -0.263, 0.162},
    {-0.964, -0.266, 0.000},
    {-0.951, -0.263, -0.162},
    {-0.916, -0.253, -0.313},
    {-0.889, -0.389, 0.241},
    {-0.913, -0.400, 0.082},
    {-0.913, -0.400, -0.082},
    {-0.889, -0.389, -0.241},
    {-0.840, -0.519, 0.160},
    {-0.851, -0.526, 0.000},
    {-0.840, -0.519, -0.160},
    {-0.771, -0.633, 0.078},
    {-0.771, -0.633, -0.078},
    {-0.689, -0.725, 0.000},
    {-0.725, 0.000, -0.689},
    {-0.633, 0.078, -0.771},
    {-0.519, 0.160, -0.840},
    {-0.389, 0.241, -0.889},
    {-0.253, 0.313, -0.916},
    {-0.121, 0.373, -0.920},
    {-0.633, -0.078, -0.771},
    {-0.526, 0.000, -0.851},
    {-0.400, 0.082, -0.913},
    {-0.263, 0.162, -0.951},
    {-0.127, 0.235, -0.964},
    {-0.519, -0.160, -0.840},
    {-0.400, -0.082, -0.913},
    {-0.266, 0.000, -0.964},
    {-0.130, 0.080, -0.988},
    {-0.389, -0.241, -0.889},
    {-0.263, -0.162, -0.951},
    {-0.130, -0.080, -0.988},
    {-0.253, -0.313, -0.916},
    {-0.127, -0.235, -0.964},
    {-0.121, -0.373, -0.920},
    {0.195, 0.569, -0.799},
    {0.283, 0.644, -0.711},
    {0.370, 0.710, -0.599},
    {0.450, 0.759, -0.469},
    {0.517, 0.789, -0.331},
    {0.569, 0.799, -0.195},
    {0.331, 0.517, -0.789},
    {0.425, 0.588, -0.688},
    {0.513, 0.647, -0.564},
    {0.588, 0.688, -0.425},
    {0.644, 0.711, -0.283},
    {0.469, 0.450, -0.759},
    {0.564, 0.513, -0.647},
    {0.647, 0.564, -0.513},
    {0.710, 0.599, -0.370},
    {0.599, 0.370, -0.710},
    {0.688, 0.425, -0.588},
    {0.759, 0.469, -0.450},
    {0.711, 0.283, -0.644},
    {0.789, 0.331, -0.517},
    {0.799, 0.195, -0.569},
    {0.569, -0.799, 0.195},
    {0.644, -0.711, 0.283},
    {0.710, -0.599, 0.370},
    {0.759, -0.469, 0.450},
    {0.789, -0.331, 0.517},
    {0.799, -0.195, 0.569},
    {0.517, -0.789, 0.331},
    {0.588, -0.688, 0.425},
    {0.647, -0.564, 0.513},
    {0.688, -0.425, 0.588},
    {0.711, -0.283, 0.644},
    {0.450, -0.759, 0.469},
    {0.513, -0.647, 0.564},
    {0.564, -0.513, 0.647},
    {0.599, -0.370, 0.710},
    {0.370, -0.710, 0.599},
    {0.425, -0.588, 0.688},
    {0.469, -0.450, 0.759},
    {0.283, -0.644, 0.711},
    {0.331, -0.517, 0.789},
    {0.195, -0.569, 0.799},
    {0.373, -0.920, 0.121},
    {0.313, -0.916, 0.253},
    {0.241, -0.889, 0.389},
    {0.160, -0.840, 0.519},
    {0.078, -0.771, 0.633},
    {0.000, -0.689, 0.725},
    {0.235, -0.964, 0.127},
    {0.162, -0.951, 0.263},
    {0.082, -0.913, 0.400},
    {0.000, -0.851, 0.526},
    {-0.078, -0.771, 0.633},
    {0.080, -0.988, 0.130},
    {0.000, -0.964, 0.266},
    {-0.082, -0.913, 0.400},
    {-0.160, -0.840, 0.519},
    {-0.080, -0.988, 0.130},
    {-0.162, -0.951, 0.263},
    {-0.241, -0.889, 0.389},
    {-0.235, -0.964, 0.127},
    {-0.313, -0.916, 0.253},
    {-0.373, -0.920, 0.121},
    {0.373, -0.920, -0.121},
    {0.235, -0.964, -0.127},
    {0.080, -0.988, -0.130},
    {-0.080, -0.988, -0.130},
    {-0.235, -0.964, -0.127},
    {-0.373, -0.920, -0.121},
    {0.313, -0.916, -0.253},
    {0.162, -0.951, -0.263},
    {0.000, -0.964, -0.266},
    {-0.162, -0.951, -0.263},
    {-0.313, -0.916, -0.253},
    {0.241, -0.889, -0.389},
    {0.082, -0.913, -0.400},
    {-0.082, -0.913, -0.400},
    {-0.241, -0.889, -0.389},
    {0.160, -0.840, -0.519},
    {0.000, -0.851, -0.526},
    {-0.160, -0.840, -0.519},
    {0.078, -0.771, -0.633},
    {-0.078, -0.771, -0.633},
    {0.000, -0.689, -0.725},
    {0.569, -0.799, -0.195},
    {0.517, -0.789, -0.331},
    {0.450, -0.759, -0.469},
    {0.370, -0.710, -0.599},
    {0.283, -0.644, -0.711},
    {0.195, -0.569, -0.799},
    {0.644, -0.711, -0.283},
    {0.588, -0.688, -0.425},
    {0.513, -0.647, -0.564},
    {0.425, -0.588, -0.688},
    {0.331, -0.517, -0.789},
    {0.710, -0.599, -0.370},
    {0.647, -0.564, -0.513},
    {0.564, -0.513, -0.647},
    {0.469, -0.450, -0.759},
    {0.759, -0.469, -0.450},
    {0.688, -0.425, -0.588},
    {0.599, -0.370, -0.710},
    {0.789, -0.331, -0.517},
    {0.711, -0.283, -0.644},
    {0.799, -0.195, -0.569},
    {0.689, -0.725, 0.000},
    {0.771, -0.633, -0.078},
    {0.840, -0.519, -0.160},
    {0.889, -0.389, -0.241},
    {0.916, -0.253, -0.313},
    {0.920, -0.121, -0.373},
    {0.771, -0.633, 0.078},
    {0.851, -0.526, 0.000},
    {0.913, -0.400, -0.082},
    {0.951, -0.263, -0.162},
    {0.964, -0.127, -0.235},
    {0.840, -0.519, 0.160},
    {0.913, -0.400, 0.082},
    {0.964, -0.266, 0.000},
    {0.988, -0.130, -0.080},
    {0.889, -0.389, 0.241},
    {0.951, -0.263, 0.162},
    {0.988, -0.130, 0.080},
    {0.916, -0.253, 0.313},
    {0.964, -0.127, 0.235},
    {0.920, -0.121, 0.373},
    {0.121, -0.373, 0.920},
    {0.253, -0.313, 0.916},
    {0.389, -0.241, 0.889},
    {0.519, -0.160, 0.840},
    {0.633, -0.078, 0.771},
    {0.725, 0.000, 0.689},
    {0.127, -0.235, 0.964},
    {0.263, -0.162, 0.951},
    {0.400, -0.082, 0.913},
    {0.526, 0.000, 0.851},
    {0.633, 0.078, 0.771},
    {0.130, -0.080, 0.988},
    {0.266, 0.000, 0.964},
    {0.400, 0.082, 0.913},
    {0.519, 0.160, 0.840},
    {0.130, 0.080, 0.988},
    {0.263, 0.162, 0.951},
    {0.389, 0.241, 0.889},
    {0.127, 0.235, 0.964},
    {0.253, 0.313, 0.916},
    {0.121, 0.373, 0.920},
    {-0.569, -0.799, 0.195},
    {-0.517, -0.789, 0.331},
    {-0.450, -0.759, 0.469},
    {-0.370, -0.710, 0.599},
    {-0.283, -0.644, 0.711},
    {-0.195, -0.569, 0.799},
    {-0.644, -0.711, 0.283},
    {-0.588, -0.688, 0.425},
    {-0.513, -0.647, 0.564},
    {-0.425, -0.588, 0.688},
    {-0.331, -0.517, 0.789},
    {-0.710, -0.599, 0.370},
    {-0.647, -0.564, 0.513},
    {-0.564, -0.513, 0.647},
    {-0.469, -0.450, 0.759},
    {-0.759, -0.469, 0.450},
    {-0.688, -0.425, 0.588},
    {-0.599, -0.370, 0.710},
    {-0.789, -0.331, 0.517},
    {-0.711, -0.283, 0.644},
    {-0.799, -0.195, 0.569},
    {-0.195, -0.569, -0.799},
    {-0.283, -0.644, -0.711},
    {-0.370, -0.710, -0.599},
    {-0.450, -0.759, -0.469},
    {-0.517, -0.789, -0.331},
    {-0.569, -0.799, -0.195},
    {-0.331, -0.517, -0.789},
    {-0.425, -0.588, -0.688},
    {-0.513, -0.647, -0.564},
    {-0.588, -0.688, -0.425},
    {-0.644, -0.711, -0.283},
    {-0.469, -0.450, -0.759},
    {-0.564, -0.513, -0.647},
    {-0.647, -0.564, -0.513},
    {-0.710, -0.599, -0.370},
    {-0.599, -0.370, -0.710},
    {-0.688, -0.425, -0.588},
    {-0.759, -0.469, -0.450},
    {-0.711, -0.283, -0.644},
    {-0.789, -0.331, -0.517},
    {-0.799, -0.195, -0.569},
    {0.725, 0.000, -0.689},
    {0.633, -0.078, -0.771},
    {0.519, -0.160, -0.840},
    {0.389, -0.241, -0.889},
    {0.253, -0.313, -0.916},
    {0.121, -0.373, -0.920},
    {0.633, 0.078, -0.771},
    {0.526, 0.000, -0.851},
    {0.400, -0.082, -0.913},
    {0.263, -0.162, -0.951},
    {0.127, -0.235, -0.964},
    {0.519, 0.160, -0.840},
    {0.400, 0.082, -0.913},
    {0.266, 0.000, -0.964},
    {0.130, -0.080, -0.988},
    {0.389, 0.241, -0.889},
    {0.263, 0.162, -0.951},
    {0.130, 0.080, -0.988},
    {0.253, 0.313, -0.916},
    {0.127, 0.235, -0.964},
    {0.121, 0.373, -0.920},
    {0.920, 0.121, 0.373},
    {0.964, 0.127, 0.235},
    {0.988, 0.130, 0.080},
    {0.988, 0.130, -0.080},
    {0.964, 0.127, -0.235},
    {0.920, 0.121, -0.373},
    {0.916, 0.253, 0.313},
    {0.951, 0.263, 0.162},
    {0.964, 0.266, 0.000},
    {0.951, 0.263, -0.162},
    {0.916, 0.253, -0.313},
    {0.889, 0.389, 0.241},
    {0.913, 0.400, 0.082},
    {0.913, 0.400, -0.082},
    {0.889, 0.389, -0.241},
    {0.840, 0.519, 0.160},
    {0.851, 0.526, 0.000},
    {0.840, 0.519, -0.160},
    {0.771, 0.633, 0.078},
    {0.771, 0.633, -0.078},
    {0.689, 0.725, 0.000},
  };

  size_t faces[][3] = {
    {0, 75, 138},
    {75, 76, 222},
    {76, 77, 223},
    {77, 78, 224},
    {78, 79, 225},
    {79, 80, 226},
    {80, 81, 227},
    {81, 11, 116},
    {75, 222, 138},
    {76, 223, 222},
    {77, 224, 223},
    {78, 225, 224},
    {79, 226, 225},
    {80, 227, 226},
    {81, 116, 227},
    {138, 222, 139},
    {222, 223, 228},
    {223, 224, 229},
    {224, 225, 230},
    {225, 226, 231},
    {226, 227, 232},
    {227, 116, 115},
    {222, 228, 139},
    {223, 229, 228},
    {224, 230, 229},
    {225, 231, 230},
    {226, 232, 231},
    {227, 115, 232},
    {139, 228, 140},
    {228, 229, 233},
    {229, 230, 234},
    {230, 231, 235},
    {231, 232, 236},
    {232, 115, 114},
    {228, 233, 140},
    {229, 234, 233},
    {230, 235, 234},
    {231, 236, 235},
    {232, 114, 236},
    {140, 233, 141},
    {233, 234, 237},
    {234, 235, 238},
    {235, 236, 239},
    {236, 114, 113},
    {233, 237, 141},
    {234, 238, 237},
    {235, 239, 238},
    {236, 113, 239},
    {141, 237, 142},
    {237, 238, 240},
    {238, 239, 241},
    {239, 113, 112},
    {237, 240, 142},
    {238, 241, 240},
    {239, 112, 241},
    {142, 240, 143},
    {240, 241, 242},
    {241, 112, 111},
    {240, 242, 143},
    {241, 111, 242},
    {143, 242, 144},
    {242, 111, 110},
    {242, 110, 144},
    {144, 110, 5},
    {0, 138, 166},
    {138, 139, 243},
    {139, 140, 244},
    {140, 141, 245},
    {141, 142, 246},
    {142, 143, 247},
    {143, 144, 248},
    {144, 5, 74},
    {138, 243, 166},
    {139, 244, 243},
    {140, 245, 244},
    {141, 246, 245},
    {142, 247, 246},
    {143, 248, 247},
    {144, 74, 248},
    {166, 243, 167},
    {243, 244, 249},
    {244, 245, 250},
    {245, 246, 251},
    {246, 247, 252},
    {247, 248, 253},
    {248, 74, 73},
    {243, 249, 167},
    {244, 250, 249},
    {245, 251, 250},
    {246, 252, 251},
    {247, 253, 252},
    {248, 73, 253},
    {167, 249, 168},
    {249, 250, 254},
    {250, 251, 255},
    {251, 252, 256},
    {252, 253, 257},
    {253, 73, 72},
    {249, 254, 168},
    {250, 255, 254},
    {251, 256, 255},
    {252, 257, 256},
    {253, 72, 257},
    {168, 254, 169},
    {254, 255, 258},
    {255, 256, 259},
    {256, 257, 260},
    {257, 72, 71},
    {254, 258, 169},
    {255, 259, 258},
    {256, 260, 259},
    {257, 71, 260},
    {169, 258, 170},
    {258, 259, 261},
    {259, 260, 262},
    {260, 71, 70},
    {258, 261, 170},
    {259, 262, 261},
    {260, 70, 262},
    {170, 261, 171},
    {261, 262, 263},
    {262, 70, 69},
    {261, 263, 171},
    {262, 69, 263},
    {171, 263, 172},
    {263, 69, 68},
    {263, 68, 172},
    {172, 68, 1},
    {0, 166, 26},
    {166, 167, 264},
    {167, 168, 265},
    {168, 169, 266},
    {169, 170, 267},
    {170, 171, 268},
    {171, 172, 269},
    {172, 1, 201},
    {166, 264, 26},
    {167, 265, 264},
    {168, 266, 265},
    {169, 267, 266},
    {170, 268, 267},
    {171, 269, 268},
    {172, 201, 269},
    {26, 264, 27},
    {264, 265, 270},
    {265, 266, 271},
    {266, 267, 272},
    {267, 268, 273},
    {268, 269, 274},
    {269, 201, 202},
    {264, 270, 27},
    {265, 271, 270},
    {266, 272, 271},
    {267, 273, 272},
    {268, 274, 273},
    {269, 202, 274},
    {27, 270, 28},
    {270, 271, 275},
    {271, 272, 276},
    {272, 273, 277},
    {273, 274, 278},
    {274, 202, 203},
    {270, 275, 28},
    {271, 276, 275},
    {272, 277, 276},
    {273, 278, 277},
    {274, 203, 278},
    {28, 275, 29},
    {275, 276, 279},
    {276, 277, 280},
    {277, 278, 281},
    {278, 203, 204},
    {275, 279, 29},
    {276, 280, 279},
    {277, 281, 280},
    {278, 204, 281},
    {29, 279, 30},
    {279, 280, 282},
    {280, 281, 283},
    {281, 204, 205},
    {279, 282, 30},
    {280, 283, 282},
    {281, 205, 283},
    {30, 282, 31},
    {282, 283, 284},
    {283, 205, 206},
    {282, 284, 31},
    {283, 206, 284},
    {31, 284, 32},
    {284, 206, 207},
    {284, 207, 32},
    {32, 207, 7},
    {0, 26, 40},
    {26, 27, 285},
    {27, 28, 286},
    {28, 29, 287},
    {29, 30, 288},
    {30, 31, 289},
    {31, 32, 290},
    {32, 7, 82},
    {26, 285, 40},
    {27, 286, 285},
    {28, 287, 286},
    {29, 288, 287},
    {30, 289, 288},
    {31, 290, 289},
    {32, 82, 290},
    {40, 285, 41},
    {285, 286, 291},
    {286, 287, 292},
    {287, 288, 293},
    {288, 289, 294},
    {289, 290, 295},
    {290, 82, 83},
    {285, 291, 41},
    {286, 292, 291},
    {287, 293, 292},
    {288, 294, 293},
    {289, 295, 294},
    {290, 83, 295},
    {41, 291, 42},
    {291, 292, 296},
    {292, 293, 297},
    {293, 294, 298},
    {294, 295, 299},
    {295, 83, 84},
    {291, 296, 42},
    {292, 297, 296},
    {293, 298, 297},
    {294, 299, 298},
    {295, 84, 299},
    {42, 296, 43},
    {296, 297, 300},
    {297, 298, 301},
    {298, 299, 302},
    {299, 84, 85},
    {296, 300, 43},
    {297, 301, 300},
    {298, 302, 301},
    {299, 85, 302},
    {43, 300, 44},
    {300, 301, 303},
    {301, 302, 304},
    {302, 85, 86},
    {300, 303, 44},
    {301, 304, 303},
    {302, 86, 304},
    {44, 303, 45},
    {303, 304, 305},
    {304, 86, 87},
    {303, 305, 45},
    {304, 87, 305},
    {45, 305, 46},
    {305, 87, 88},
    {305, 88, 46},
    {46, 88, 10},
    {0, 40, 75},
    {40, 41, 306},
    {41, 42, 307},
    {42, 43, 308},
    {43, 44, 309},
    {44, 45, 310},
    {45, 46, 311},
    {46, 10, 19},
    {40, 306, 75},
    {41, 307, 306},
    {42, 308, 307},
    {43, 309, 308},
    {44, 310, 309},
    {45, 311, 310},
    {46, 19, 311},
    {75, 306, 76},
    {306, 307, 312},
    {307, 308, 313},
    {308, 309, 314},
    {309, 310, 315},
    {310, 311, 316},
    {311, 19, 20},
    {306, 312, 76},
    {307, 313, 312},
    {308, 314, 313},
    {309, 315, 314},
    {310, 316, 315},
    {311, 20, 316},
    {76, 312, 77},
    {312, 313, 317},
    {313, 314, 318},
    {314, 315, 319},
    {315, 316, 320},
    {316, 20, 21},
    {312, 317, 77},
    {313, 318, 317},
    {314, 319, 318},
    {315, 320, 319},
    {316, 21, 320},
    {77, 317, 78},
    {317, 318, 321},
    {318, 319, 322},
    {319, 320, 323},
    {320, 21, 22},
    {317, 321, 78},
    {318, 322, 321},
    {319, 323, 322},
    {320, 22, 323},
    {78, 321, 79},
    {321, 322, 324},
    {322, 323, 325},
    {323, 22, 23},
    {321, 324, 79},
    {322, 325, 324},
    {323, 23, 325},
    {79, 324, 80},
    {324, 325, 326},
    {325, 23, 24},
    {324, 326, 80},
    {325, 24, 326},
    {80, 326, 81},
    {326, 24, 25},
    {326, 25, 81},
    {81, 25, 11},
    {1, 68, 145},
    {68, 69, 327},
    {69, 70, 328},
    {70, 71, 329},
    {71, 72, 330},
    {72, 73, 331},
    {73, 74, 332},
    {74, 5, 12},
    {68, 327, 145},
    {69, 328, 327},
    {70, 329, 328},
    {71, 330, 329},
    {72, 331, 330},
    {73, 332, 331},
    {74, 12, 332},
    {145, 327, 146},
    {327, 328, 333},
    {328, 329, 334},
    {329, 330, 335},
    {330, 331, 336},
    {331, 332, 337},
    {332, 12, 13},
    {327, 333, 146},
    {328, 334, 333},
    {329, 335, 334},
    {330, 336, 335},
    {331, 337, 336},
    {332, 13, 337},
    {146, 333, 147},
    {333, 334, 338},
    {334, 335, 339},
    {335, 336, 340},
    {336, 337, 341},
    {337, 13, 14},
    {333, 338, 147},
    {334, 339, 338},
    {335, 340, 339},
    {336, 341, 340},
    {337, 14, 341},
    {147, 338, 148},
    {338, 339, 342},
    {339, 340, 343},
    {340, 341, 344},
    {341, 14, 15},
    {338, 342, 148},
    {339, 343, 342},
    {340, 344, 343},
    {341, 15, 344},
    {148, 342, 149},
    {342, 343, 345},
    {343, 344, 346},
    {344, 15, 16},
    {342, 345, 149},
    {343, 346, 345},
    {344, 16, 346},
    {149, 345, 150},
    {345, 346, 347},
    {346, 16, 17},
    {345, 347, 150},
    {346, 17, 347},
    {150, 347, 151},
    {347, 17, 18},
    {347, 18, 151},
    {151, 18, 9},
    {5, 110, 123},
    {110, 111, 348},
    {111, 112, 349},
    {112, 113, 350},
    {113, 114, 351},
    {114, 115, 352},
    {115, 116, 353},
    {116, 11, 165},
    {110, 348, 123},
    {111, 349, 348},
    {112, 350, 349},
    {113, 351, 350},
    {114, 352, 351},
    {115, 353, 352},
    {116, 165, 353},
    {123, 348, 122},
    {348, 349, 354},
    {349, 350, 355},
    {350, 351, 356},
    {351, 352, 357},
    {352, 353, 358},
    {353, 165, 164},
    {348, 354, 122},
    {349, 355, 354},
    {350, 356, 355},
    {351, 357, 356},
    {352, 358, 357},
    {353, 164, 358},
    {122, 354, 121},
    {354, 355, 359},
    {355, 356, 360},
    {356, 357, 361},
    {357, 358, 362},
    {358, 164, 163},
    {354, 359, 121},
    {355, 360, 359},
    {356, 361, 360},
    {357, 362, 361},
    {358, 163, 362},
    {121, 359, 120},
    {359, 360, 363},
    {360, 361, 364},
    {361, 362, 365},
    {362, 163, 162},
    {359, 363, 120},
    {360, 364, 363},
    {361, 365, 364},
    {362, 162, 365},
    {120, 363, 119},
    {363, 364, 366},
    {364, 365, 367},
    {365, 162, 161},
    {363, 366, 119},
    {364, 367, 366},
    {365, 161, 367},
    {119, 366, 118},
    {366, 367, 368},
    {367, 161, 160},
    {366, 368, 118},
    {367, 160, 368},
    {118, 368, 117},
    {368, 160, 159},
    {368, 159, 117},
    {117, 159, 4},
    {11, 25, 186},
    {25, 24, 369},
    {24, 23, 370},
    {23, 22, 371},
    {22, 21, 372},
    {21, 20, 373},
    {20, 19, 374},
    {19, 10, 130},
    {25, 369, 186},
    {24, 370, 369},
    {23, 371, 370},
    {22, 372, 371},
    {21, 373, 372},
    {20, 374, 373},
    {19, 130, 374},
    {186, 369, 185},
    {369, 370, 375},
    {370, 371, 376},
    {371, 372, 377},
    {372, 373, 378},
    {373, 374, 379},
    {374, 130, 129},
    {369, 375, 185},
    {370, 376, 375},
    {371, 377, 376},
    {372, 378, 377},
    {373, 379, 378},
    {374, 129, 379},
    {185, 375, 184},
    {375, 376, 380},
    {376, 377, 381},
    {377, 378, 382},
    {378, 379, 383},
    {379, 129, 128},
    {375, 380, 184},
    {376, 381, 380},
    {377, 382, 381},
    {378, 383, 382},
    {379, 128, 383},
    {184, 380, 183},
    {380, 381, 384},
    {381, 382, 385},
    {382, 383, 386},
    {383, 128, 127},
    {380, 384, 183},
    {381, 385, 384},
    {382, 386, 385},
    {383, 127, 386},
    {183, 384, 182},
    {384, 385, 387},
    {385, 386, 388},
    {386, 127, 126},
    {384, 387, 182},
    {385, 388, 387},
    {386, 126, 388},
    {182, 387, 181},
    {387, 388, 389},
    {388, 126, 125},
    {387, 389, 181},
    {388, 125, 389},
    {181, 389, 180},
    {389, 125, 124},
    {389, 124, 180},
    {180, 124, 2},
    {10, 88, 67},
    {88, 87, 390},
    {87, 86, 391},
    {86, 85, 392},
    {85, 84, 393},
    {84, 83, 394},
    {83, 82, 395},
    {82, 7, 53},
    {88, 390, 67},
    {87, 391, 390},
    {86, 392, 391},
    {85, 393, 392},
    {84, 394, 393},
    {83, 395, 394},
    {82, 53, 395},
    {67, 390, 66},
    {390, 391, 396},
    {391, 392, 397},
    {392, 393, 398},
    {393, 394, 399},
    {394, 395, 400},
    {395, 53, 52},
    {390, 396, 66},
    {391, 397, 396},
    {392, 398, 397},
    {393, 399, 398},
    {394, 400, 399},
    {395, 52, 400},
    {66, 396, 65},
    {396, 397, 401},
    {397, 398, 402},
    {398, 399, 403},
    {399, 400, 404},
    {400, 52, 51},
    {396, 401, 65},
    {397, 402, 401},
    {398, 403, 402},
    {399, 404, 403},
    {400, 51, 404},
    {65, 401, 64},
    {401, 402, 405},
    {402, 403, 406},
    {403, 404, 407},
    {404, 51, 50},
    {401, 405, 64},
    {402, 406, 405},
    {403, 407, 406},
    {404, 50, 407},
    {64, 405, 63},
    {405, 406, 408},
    {406, 407, 409},
    {407, 50, 49},
    {405, 408, 63},
    {406, 409, 408},
    {407, 49, 409},
    {63, 408, 62},
    {408, 409, 410},
    {409, 49, 48},
    {408, 410, 62},
    {409, 48, 410},
    {62, 410, 61},
    {410, 48, 47},
    {410, 47, 61},
    {61, 47, 6},
    {7, 207, 208},
    {207, 206, 411},
    {206, 205, 412},
    {205, 204, 413},
    {204, 203, 414},
    {203, 202, 415},
    {202, 201, 416},
    {201, 1, 194},
    {207, 411, 208},
    {206, 412, 411},
    {205, 413, 412},
    {204, 414, 413},
    {203, 415, 414},
    {202, 416, 415},
    {201, 194, 416},
    {208, 411, 209},
    {411, 412, 417},
    {412, 413, 418},
    {413, 414, 419},
    {414, 415, 420},
    {415, 416, 421},
    {416, 194, 195},
    {411, 417, 209},
    {412, 418, 417},
    {413, 419, 418},
    {414, 420, 419},
    {415, 421, 420},
    {416, 195, 421},
    {209, 417, 210},
    {417, 418, 422},
    {418, 419, 423},
    {419, 420, 424},
    {420, 421, 425},
    {421, 195, 196},
    {417, 422, 210},
    {418, 423, 422},
    {419, 424, 423},
    {420, 425, 424},
    {421, 196, 425},
    {210, 422, 211},
    {422, 423, 426},
    {423, 424, 427},
    {424, 425, 428},
    {425, 196, 197},
    {422, 426, 211},
    {423, 427, 426},
    {424, 428, 427},
    {425, 197, 428},
    {211, 426, 212},
    {426, 427, 429},
    {427, 428, 430},
    {428, 197, 198},
    {426, 429, 212},
    {427, 430, 429},
    {428, 198, 430},
    {212, 429, 213},
    {429, 430, 431},
    {430, 198, 199},
    {429, 431, 213},
    {430, 199, 431},
    {213, 431, 214},
    {431, 199, 200},
    {431, 200, 214},
    {214, 200, 8},
    {3, 131, 96},
    {131, 132, 432},
    {132, 133, 433},
    {133, 134, 434},
    {134, 135, 435},
    {135, 136, 436},
    {136, 137, 437},
    {137, 9, 60},
    {131, 432, 96},
    {132, 433, 432},
    {133, 434, 433},
    {134, 435, 434},
    {135, 436, 435},
    {136, 437, 436},
    {137, 60, 437},
    {96, 432, 97},
    {432, 433, 438},
    {433, 434, 439},
    {434, 435, 440},
    {435, 436, 441},
    {436, 437, 442},
    {437, 60, 59},
    {432, 438, 97},
    {433, 439, 438},
    {434, 440, 439},
    {435, 441, 440},
    {436, 442, 441},
    {437, 59, 442},
    {97, 438, 98},
    {438, 439, 443},
    {439, 440, 444},
    {440, 441, 445},
    {441, 442, 446},
    {442, 59, 58},
    {438, 443, 98},
    {439, 444, 443},
    {440, 445, 444},
    {441, 446, 445},
    {442, 58, 446},
    {98, 443, 99},
    {443, 444, 447},
    {444, 445, 448},
    {445, 446, 449},
    {446, 58, 57},
    {443, 447, 99},
    {444, 448, 447},
    {445, 449, 448},
    {446, 57, 449},
    {99, 447, 100},
    {447, 448, 450},
    {448, 449, 451},
    {449, 57, 56},
    {447, 450, 100},
    {448, 451, 450},
    {449, 56, 451},
    {100, 450, 101},
    {450, 451, 452},
    {451, 56, 55},
    {450, 452, 101},
    {451, 55, 452},
    {101, 452, 102},
    {452, 55, 54},
    {452, 54, 102},
    {102, 54, 4},
    {3, 96, 158},
    {96, 97, 453},
    {97, 98, 454},
    {98, 99, 455},
    {99, 100, 456},
    {100, 101, 457},
    {101, 102, 458},
    {102, 4, 221},
    {96, 453, 158},
    {97, 454, 453},
    {98, 455, 454},
    {99, 456, 455},
    {100, 457, 456},
    {101, 458, 457},
    {102, 221, 458},
    {158, 453, 157},
    {453, 454, 459},
    {454, 455, 460},
    {455, 456, 461},
    {456, 457, 462},
    {457, 458, 463},
    {458, 221, 220},
    {453, 459, 157},
    {454, 460, 459},
    {455, 461, 460},
    {456, 462, 461},
    {457, 463, 462},
    {458, 220, 463},
    {157, 459, 156},
    {459, 460, 464},
    {460, 461, 465},
    {461, 462, 466},
    {462, 463, 467},
    {463, 220, 219},
    {459, 464, 156},
    {460, 465, 464},
    {461, 466, 465},
    {462, 467, 466},
    {463, 219, 467},
    {156, 464, 155},
    {464, 465, 468},
    {465, 466, 469},
    {466, 467, 470},
    {467, 219, 218},
    {464, 468, 155},
    {465, 469, 468},
    {466, 470, 469},
    {467, 218, 470},
    {155, 468, 154},
    {468, 469, 471},
    {469, 470, 472},
    {470, 218, 217},
    {468, 471, 154},
    {469, 472, 471},
    {470, 217, 472},
    {154, 471, 153},
    {471, 472, 473},
    {472, 217, 216},
    {471, 473, 153},
    {472, 216, 473},
    {153, 473, 152},
    {473, 216, 215},
    {473, 215, 152},
    {152, 215, 2},
    {3, 158, 89},
    {158, 157, 474},
    {157, 156, 475},
    {156, 155, 476},
    {155, 154, 477},
    {154, 153, 478},
    {153, 152, 479},
    {152, 2, 103},
    {158, 474, 89},
    {157, 475, 474},
    {156, 476, 475},
    {155, 477, 476},
    {154, 478, 477},
    {153, 479, 478},
    {152, 103, 479},
    {89, 474, 90},
    {474, 475, 480},
    {475, 476, 481},
    {476, 477, 482},
    {477, 478, 483},
    {478, 479, 484},
    {479, 103, 104},
    {474, 480, 90},
    {475, 481, 480},
    {476, 482, 481},
    {477, 483, 482},
    {478, 484, 483},
    {479, 104, 484},
    {90, 480, 91},
    {480, 481, 485},
    {481, 482, 486},
    {482, 483, 487},
    {483, 484, 488},
    {484, 104, 105},
    {480, 485, 91},
    {481, 486, 485},
    {482, 487, 486},
    {483, 488, 487},
    {484, 105, 488},
    {91, 485, 92},
    {485, 486, 489},
    {486, 487, 490},
    {487, 488, 491},
    {488, 105, 106},
    {485, 489, 92},
    {486, 490, 489},
    {487, 491, 490},
    {488, 106, 491},
    {92, 489, 93},
    {489, 490, 492},
    {490, 491, 493},
    {491, 106, 107},
    {489, 492, 93},
    {490, 493, 492},
    {491, 107, 493},
    {93, 492, 94},
    {492, 493, 494},
    {493, 107, 108},
    {492, 494, 94},
    {493, 108, 494},
    {94, 494, 95},
    {494, 108, 109},
    {494, 109, 95},
    {95, 109, 6},
    {3, 89, 187},
    {89, 90, 495},
    {90, 91, 496},
    {91, 92, 497},
    {92, 93, 498},
    {93, 94, 499},
    {94, 95, 500},
    {95, 6, 173},
    {89, 495, 187},
    {90, 496, 495},
    {91, 497, 496},
    {92, 498, 497},
    {93, 499, 498},
    {94, 500, 499},
    {95, 173, 500},
    {187, 495, 188},
    {495, 496, 501},
    {496, 497, 502},
    {497, 498, 503},
    {498, 499, 504},
    {499, 500, 505},
    {500, 173, 174},
    {495, 501, 188},
    {496, 502, 501},
    {497, 503, 502},
    {498, 504, 503},
    {499, 505, 504},
    {500, 174, 505},
    {188, 501, 189},
    {501, 502, 506},
    {502, 503, 507},
    {503, 504, 508},
    {504, 505, 509},
    {505, 174, 175},
    {501, 506, 189},
    {502, 507, 506},
    {503, 508, 507},
    {504, 509, 508},
    {505, 175, 509},
    {189, 506, 190},
    {506, 507, 510},
    {507, 508, 511},
    {508, 509, 512},
    {509, 175, 176},
    {506, 510, 190},
    {507, 511, 510},
    {508, 512, 511},
    {509, 176, 512},
    {190, 510, 191},
    {510, 511, 513},
    {511, 512, 514},
    {512, 176, 177},
    {510, 513, 191},
    {511, 514, 513},
    {512, 177, 514},
    {191, 513, 192},
    {513, 514, 515},
    {514, 177, 178},
    {513, 515, 192},
    {514, 178, 515},
    {192, 515, 193},
    {515, 178, 179},
    {515, 179, 193},
    {193, 179, 8},
    {3, 187, 131},
    {187, 188, 516},
    {188, 189, 517},
    {189, 190, 518},
    {190, 191, 519},
    {191, 192, 520},
    {192, 193, 521},
    {193, 8, 33},
    {187, 516, 131},
    {188, 517, 516},
    {189, 518, 517},
    {190, 519, 518},
    {191, 520, 519},
    {192, 521, 520},
    {193, 33, 521},
    {131, 516, 132},
    {516, 517, 522},
    {517, 518, 523},
    {518, 519, 524},
    {519, 520, 525},
    {520, 521, 526},
    {521, 33, 34},
    {516, 522, 132},
    {517, 523, 522},
    {518, 524, 523},
    {519, 525, 524},
    {520, 526, 525},
    {521, 34, 526},
    {132, 522, 133},
    {522, 523, 527},
    {523, 524, 528},
    {524, 525, 529},
    {525, 526, 530},
    {526, 34, 35},
    {522, 527, 133},
    {523, 528, 527},
    {524, 529, 528},
    {525, 530, 529},
    {526, 35, 530},
    {133, 527, 134},
    {527, 528, 531},
    {528, 529, 532},
    {529, 530, 533},
    {530, 35, 36},
    {527, 531, 134},
    {528, 532, 531},
    {529, 533, 532},
    {530, 36, 533},
    {134, 531, 135},
    {531, 532, 534},
    {532, 533, 535},
    {533, 36, 37},
    {531, 534, 135},
    {532, 535, 534},
    {533, 37, 535},
    {135, 534, 136},
    {534, 535, 536},
    {535, 37, 38},
    {534, 536, 136},
    {535, 38, 536},
    {136, 536, 137},
    {536, 38, 39},
    {536, 39, 137},
    {137, 39, 9},
    {4, 54, 117},
    {54, 55, 537},
    {55, 56, 538},
    {56, 57, 539},
    {57, 58, 540},
    {58, 59, 541},
    {59, 60, 542},
    {60, 9, 18},
    {54, 537, 117},
    {55, 538, 537},
    {56, 539, 538},
    {57, 540, 539},
    {58, 541, 540},
    {59, 542, 541},
    {60, 18, 542},
    {117, 537, 118},
    {537, 538, 543},
    {538, 539, 544},
    {539, 540, 545},
    {540, 541, 546},
    {541, 542, 547},
    {542, 18, 17},
    {537, 543, 118},
    {538, 544, 543},
    {539, 545, 544},
    {540, 546, 545},
    {541, 547, 546},
    {542, 17, 547},
    {118, 543, 119},
    {543, 544, 548},
    {544, 545, 549},
    {545, 546, 550},
    {546, 547, 551},
    {547, 17, 16},
    {543, 548, 119},
    {544, 549, 548},
    {545, 550, 549},
    {546, 551, 550},
    {547, 16, 551},
    {119, 548, 120},
    {548, 549, 552},
    {549, 550, 553},
    {550, 551, 554},
    {551, 16, 15},
    {548, 552, 120},
    {549, 553, 552},
    {550, 554, 553},
    {551, 15, 554},
    {120, 552, 121},
    {552, 553, 555},
    {553, 554, 556},
    {554, 15, 14},
    {552, 555, 121},
    {553, 556, 555},
    {554, 14, 556},
    {121, 555, 122},
    {555, 556, 557},
    {556, 14, 13},
    {555, 557, 122},
    {556, 13, 557},
    {122, 557, 123},
    {557, 13, 12},
    {557, 12, 123},
    {123, 12, 5},
    {2, 215, 180},
    {215, 216, 558},
    {216, 217, 559},
    {217, 218, 560},
    {218, 219, 561},
    {219, 220, 562},
    {220, 221, 563},
    {221, 4, 159},
    {215, 558, 180},
    {216, 559, 558},
    {217, 560, 559},
    {218, 561, 560},
    {219, 562, 561},
    {220, 563, 562},
    {221, 159, 563},
    {180, 558, 181},
    {558, 559, 564},
    {559, 560, 565},
    {560, 561, 566},
    {561, 562, 567},
    {562, 563, 568},
    {563, 159, 160},
    {558, 564, 181},
    {559, 565, 564},
    {560, 566, 565},
    {561, 567, 566},
    {562, 568, 567},
    {563, 160, 568},
    {181, 564, 182},
    {564, 565, 569},
    {565, 566, 570},
    {566, 567, 571},
    {567, 568, 572},
    {568, 160, 161},
    {564, 569, 182},
    {565, 570, 569},
    {566, 571, 570},
    {567, 572, 571},
    {568, 161, 572},
    {182, 569, 183},
    {569, 570, 573},
    {570, 571, 574},
    {571, 572, 575},
    {572, 161, 162},
    {569, 573, 183},
    {570, 574, 573},
    {571, 575, 574},
    {572, 162, 575},
    {183, 573, 184},
    {573, 574, 576},
    {574, 575, 577},
    {575, 162, 163},
    {573, 576, 184},
    {574, 577, 576},
    {575, 163, 577},
    {184, 576, 185},
    {576, 577, 578},
    {577, 163, 164},
    {576, 578, 185},
    {577, 164, 578},
    {185, 578, 186},
    {578, 164, 165},
    {578, 165, 186},
    {186, 165, 11},
    {6, 109, 61},
    {109, 108, 579},
    {108, 107, 580},
    {107, 106, 581},
    {106, 105, 582},
    {105, 104, 583},
    {104, 103, 584},
    {103, 2, 124},
    {109, 579, 61},
    {108, 580, 579},
    {107, 581, 580},
    {106, 582, 581},
    {105, 583, 582},
    {104, 584, 583},
    {103, 124, 584},
    {61, 579, 62},
    {579, 580, 585},
    {580, 581, 586},
    {581, 582, 587},
    {582, 583, 588},
    {583, 584, 589},
    {584, 124, 125},
    {579, 585, 62},
    {580, 586, 585},
    {581, 587, 586},
    {582, 588, 587},
    {583, 589, 588},
    {584, 125, 589},
    {62, 585, 63},
    {585, 586, 590},
    {586, 587, 591},
    {587, 588, 592},
    {588, 589, 593},
    {589, 125, 126},
    {585, 590, 63},
    {586, 591, 590},
    {587, 592, 591},
    {588, 593, 592},
    {589, 126, 593},
    {63, 590, 64},
    {590, 591, 594},
    {591, 592, 595},
    {592, 593, 596},
    {593, 126, 127},
    {590, 594, 64},
    {591, 595, 594},
    {592, 596, 595},
    {593, 127, 596},
    {64, 594, 65},
    {594, 595, 597},
    {595, 596, 598},
    {596, 127, 128},
    {594, 597, 65},
    {595, 598, 597},
    {596, 128, 598},
    {65, 597, 66},
    {597, 598, 599},
    {598, 128, 129},
    {597, 599, 66},
    {598, 129, 599},
    {66, 599, 67},
    {599, 129, 130},
    {599, 130, 67},
    {67, 130, 10},
    {8, 179, 214},
    {179, 178, 600},
    {178, 177, 601},
    {177, 176, 602},
    {176, 175, 603},
    {175, 174, 604},
    {174, 173, 605},
    {173, 6, 47},
    {179, 600, 214},
    {178, 601, 600},
    {177, 602, 601},
    {176, 603, 602},
    {175, 604, 603},
    {174, 605, 604},
    {173, 47, 605},
    {214, 600, 213},
    {600, 601, 606},
    {601, 602, 607},
    {602, 603, 608},
    {603, 604, 609},
    {604, 605, 610},
    {605, 47, 48},
    {600, 606, 213},
    {601, 607, 606},
    {602, 608, 607},
    {603, 609, 608},
    {604, 610, 609},
    {605, 48, 610},
    {213, 606, 212},
    {606, 607, 611},
    {607, 608, 612},
    {608, 609, 613},
    {609, 610, 614},
    {610, 48, 49},
    {606, 611, 212},
    {607, 612, 611},
    {608, 613, 612},
    {609, 614, 613},
    {610, 49, 614},
    {212, 611, 211},
    {611, 612, 615},
    {612, 613, 616},
    {613, 614, 617},
    {614, 49, 50},
    {611, 615, 211},
    {612, 616, 615},
    {613, 617, 616},
    {614, 50, 617},
    {211, 615, 210},
    {615, 616, 618},
    {616, 617, 619},
    {617, 50, 51},
    {615, 618, 210},
    {616, 619, 618},
    {617, 51, 619},
    {210, 618, 209},
    {618, 619, 620},
    {619, 51, 52},
    {618, 620, 209},
    {619, 52, 620},
    {209, 620, 208},
    {620, 52, 53},
    {620, 53, 208},
    {208, 53, 7},
    {9, 39, 151},
    {39, 38, 621},
    {38, 37, 622},
    {37, 36, 623},
    {36, 35, 624},
    {35, 34, 625},
    {34, 33, 626},
    {33, 8, 200},
    {39, 621, 151},
    {38, 622, 621},
    {37, 623, 622},
    {36, 624, 623},
    {35, 625, 624},
    {34, 626, 625},
    {33, 200, 626},
    {151, 621, 150},
    {621, 622, 627},
    {622, 623, 628},
    {623, 624, 629},
    {624, 625, 630},
    {625, 626, 631},
    {626, 200, 199},
    {621, 627, 150},
    {622, 628, 627},
    {623, 629, 628},
    {624, 630, 629},
    {625, 631, 630},
    {626, 199, 631},
    {150, 627, 149},
    {627, 628, 632},
    {628, 629, 633},
    {629, 630, 634},
    {630, 631, 635},
    {631, 199, 198},
    {627, 632, 149},
    {628, 633, 632},
    {629, 634, 633},
    {630, 635, 634},
    {631, 198, 635},
    {149, 632, 148},
    {632, 633, 636},
    {633, 634, 637},
    {634, 635, 638},
    {635, 198, 197},
    {632, 636, 148},
    {633, 637, 636},
    {634, 638, 637},
    {635, 197, 638},
    {148, 636, 147},
    {636, 637, 639},
    {637, 638, 640},
    {638, 197, 196},
    {636, 639, 147},
    {637, 640, 639},
    {638, 196, 640},
    {147, 639, 146},
    {639, 640, 641},
    {640, 196, 195},
    {639, 641, 146},
    {640, 195, 641},
    {146, 641, 145},
    {641, 195, 194},
    {641, 194, 145},
    {145, 194, 1},
  };

  size_t num_verts = 642;
  size_t num_faces = 1280;

  mesh2_s *mesh;
  mesh2_alloc(&mesh);
  mesh2_init(mesh, &verts[0][0], num_verts, &faces[0][0], num_faces);

  size_t leaf_thresh = 32;
  rtree_split_strategy_e split_strategy = RTREE_SPLIT_STRATEGY_SURFACE_AREA;

  rtree_s *rtree;
  rtree_alloc(&rtree);
  rtree_init(rtree, leaf_thresh, split_strategy);
  rtree_insert_mesh2(rtree, mesh);
  rtree_build(rtree);

  dbl phi_deg_min = -15, phi_deg_max = 15;
  dbl theta_deg_min = -15, theta_deg_max = 15;
  dbl phi_deg_ptp = phi_deg_max - phi_deg_min;
  dbl theta_deg_ptp = theta_deg_max - theta_deg_min;

  size_t width = 256;
  size_t height = 256;

  ray3 ray = {.org = {-4, 0, 0}};

  // Set up camera basis
  dbl target[3] = {0, 0, 0};
  dbl front[3], up[3] = {0, 0, 1}, left[3];
  dbl3_sub(target, ray.org, front);
  dbl3_normalize(front);
  dbl3_cross(up, front, left);
  dbl3_normalize(left);
  dbl3_cross(front, left, up);
  dbl3_normalize(up);

  dbl *t = malloc(width*height*sizeof(dbl));

  dbl phi, theta;
  isect isect;
  size_t k = 0;
  for (size_t i = 0; i < width; ++i) {
    phi = phi_deg_ptp*((dbl)i)/(width - 1) + phi_deg_min;
    phi *= PI/180;
    for (size_t j = 0; j < height; ++j) {
      theta = theta_deg_ptp*((dbl)j)/(height - 1) + theta_deg_min;
      theta *= PI/180;
      get_view_direction(left, front, up, phi, theta, ray.dir);
      rtree_intersect(rtree, &ray, &isect);
      t[k++] = isect.t;
    }
  }

  FILE *fp = fopen("raytracing_t.bin", "wb");
  fwrite(t, sizeof(dbl), width*height, fp);
  fclose(fp);

  free(t);

  rtree_deinit(rtree);
  rtree_dealloc(&rtree);

  mesh2_deinit(mesh);
  mesh2_dealloc(&mesh);
}
